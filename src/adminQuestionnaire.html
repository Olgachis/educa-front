<template>
  <div class="row">
    <div id="results" show.bind="!showDetail" class="row">
      <div class="medium-8 columns">
        <h3>Lista de cuestionarios</h3>
        <hr/>
      </div>
      <div class="medium-4 columns">
        <a class="button secondary pull-right" href="/#/adminDashboard">Regresar</a>
        <a class="button primary pull-right" click.delegate="showDetailFunc(null, 'create')">Nuevo cuestionario</a>
      </div>
      <div class="medium-12 columns">
        <table>
          <thead>
          <th>No.</th>
          <th>Nombre</th>
          <th>No. Respuestas</th>
          <th>Resultados</th>
          <th>Descripción</th>
          <th></th>
          </thead>
          <tbody>
          <tr repeat.for="i of questionnaires.questionnaires">
            <td>${$index + 1}</td>
            <td>${i.name}</td>
            <td>${i.responseCount}</td>
            <td><a class="button secondary" href="/#/api/export/${i.id}">Ver</a></td>
            <td><a class="button secondary" href="/#/${i.id}/previewQuestionnaire">Vista Previa</a></td>
            <td>
              <button class="button primary pull-right" click.delegate="showDetailFunc(i, 'edit')">Editar
              </button>
            </td>
          </tr>
          <tbody>
        </table>
      </div>
    </div>
    <div id="detalleCuestionario" show.bind="showDetail" class="row">
      <div class="medium-12 columns">
        <div class="medium-9 columns">
          <h3>Detalle</h3>
          <hr/>
        </div>
        <div class="medium-3 columns">
          <button class="button alert pull-right" click.delegate="hideDetailFunc(questionnaire)"
                  disabled.bind="!questionnaire.name">Regresar
          </button>
          <button class="button primary pull-right" click.trigger="saveQuestionnaire()"
                  disabled.bind="!questionnaire.name">Guadar
          </button>
        </div>
      </div>
      <div class="medium-12 columns">
        <div class="medium-12 columns">
          <div class="medium-6 columns">
            <label>Nombre
              <input type="text" value.bind="questionnaire.name" id="questionnaire.id" required>
            </label>
          </div>
          <div class="medium-6 columns">
            <label>Descripción
              <textarea type="text" rows="5" placeholder="Descripción"
                        value.bind="questionnaire.questionnaire.text"></textarea>
            </label>
          </div>
          <div class="medium-6 columns">
            <label>Función (solo en caso de se necesario)
              <input type="text" value.bind="questionnaire.titleFunc">
            </label>
          </div>
          <div class="medium-6 columns">
            <label>Activar cuestionario ${questionnaire.active}
              <input type="checkbox" checked.bind="questionnaire.active" />
            </label>
          </div>
        </div>
        <div id="listaPreguntas" show.bind="!showDetailQuestion && questionnaire.responseCount > 0" class="medium-12 columns">
          <div class="medium-12 columns callout primary">
            <p>Ya existen respuestas para este cuestionario, por lo mismo no se puede editar</p>
          </div>
        </div>
        <div id="listaPreguntas" show.bind="!showDetailQuestion && questionnaire.responseCount == 0" class="medium-12 columns">
          <div class="medium-12 columns">
            <div id="titulo" class="medium-10 columns">
              <h4>Lista preguntas</h4>
              <hr/>
            </div>
            <div id="titulo" class="medium-2 columns">
              <button class="button primary pull-right" click.trigger="showDetailQuestionFunc()">Nueva pregunta</button>
            </div>
          </div>
          <div class="medium-12 columns">
            <div id="medium-12 columns">
              <table>
                <thead>
                  <th>No.</th>
                  <th>Id</th>
                  <th>Pregunta</th>
                  <th>Tipo</th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                </thead>
                <tbody>
                <tr repeat.for="q of questionnaire.questionnaire.questions">
                  <td>${$index}</td>
                  <td>${q.id}</td>
                  <td class="medium-8 columns">${q.displayName}</td>
                  <td>${q.type}</td>
                  <i class=""></i>
                  <td><a class="step fi-arrow-up size-24 pull-right" click.trigger="subirEtapa(q)">Subir</a></td>
                  <td><a class="fi-arrow-down pull-right" click.trigger="bajarEtapa(q)">Bajar</a></td>
                  <td><a class="button secondary pull-right" click.delegate="editQuestion(q)">Editar</a></td>
                  <td><a class="button alert pull-right" click.delegate="deleteQuestion(q)">Eliminar</a></td>
                </tr>
                <tbody>
              </table>
            </div>
          </div>
        </div>
        <div id="detallePregunta" show.bind="showDetailQuestion" class="medium-12 columns">
          <div class="medium-12">
            <div class="medium-9 columns">
              <h4>Editar pregunta</h4>
              <hr/>
            </div>
            <div class="medium-3 columns">
              <button class="button secondary alert pull-right" click.trigger="cancelQuestion()">Cancelar</button>
              <button class="button primary pull-right" show.bind="question.edit"
                      disabled.bind="!question.displayName || !question.id || !question.type"
                      click.trigger="saveEditQuestion(question)">Guarda editar
              </button>
              <button class="button primary pull-right" show.bind="!question.edit"
                      disabled.bind="!question.displayName || !question.id || !question.type"
                      click.trigger="addQuestion(question)">Guarda pregunta
              </button>
            </div>
          </div>
          <div class="medium-12">
            <form>
              <div class="medium-12">
                <div class="medium-6 columns">
                  <label>Id
                    <input type="text" value.bind="question.id" placeholder="Id de pregunta">
                  </label>
                </div>
                <div class="medium-6 columns">
                  <label>Pregunta
                    <textarea type="text" rows="5" value.bind="question.displayName"
                              placeholder="Pregunta"></textarea>
                  </label>
                </div>
              </div>
              <div class="medium-12">
                <div class="medium-6 columns">
                  <label>Tipo de pregunta
                    <select change.delegate="optionTypeQuestion(question)" value.bind="question.type">
                      <option value="text">Libre</option>
                      <option value="options">Opción</option>
                      <option value="multioptions">Opcion Multiple</option>
                    </select>
                  </label>
                </div>
                <div class="medium-6 columns"></div>
              </div>
              <div class="medium-12" show.bind="question.type == 'options' || question.type == 'multioptions'">
                <div class="medium-12 columns">
                  <h4>Nueva opción</h4>
                </div>
                <div class="medium-6 columns">
                  <div class="medium-4 columns">
                    <label>Tipo de opción
                      <select value.bind="option.type">
                        <option value="text">Texto</option>
                        <option value="otro">Otro</option>
                      </select>
                    </label>
                  </div>
                  <div class="medium-6 columns">
                    <label>Texto de la opción
                      <input type="text" value.bind="option.name">
                    </label>
                  </div>
                  <div class="medium-2 columns">
                    <br/>
                    <label>
                      <button class="button primary" click.trigger="addOptionQuestion(option)"
                              disabled.bind="!option.name">Agregar
                      </button>
                    </label>
                  </div>
                </div>
                <div class="medium-6 columns">
                  <label>Lista de opciones</label>
                  <table>
                    <tbody>
                    <tr repeat.for="o of question.options">
                      <td class="medium-9 columns">
                        <p show.bind="!o.other">${o}</p>
                        <p show.bind="o.other">${o.name}</p>
                      </td>
                      <td class="medium-3 columns">
                        <button class="button alert" click.trigger="deleteOptionQuestion(o)">Eliminar</button>
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
